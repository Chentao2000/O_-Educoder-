## 学习笔记:
IPv4  现在普遍使用ip协议 （版本4） IP协议定义数据传送的基本单位，--IP分组 及期确切的数据格式
ip协议 包括一切规则，


```
ipv4

    版本 4 | 首部长度 4 | 区分服务 8 | 总长度 16
    标识 16            | 标志 3 | 片位移 13
    生存时间 8 | 协议 8 | 首部校验和 16
    源地址 4B
    目的地址 4B
    可选字段 （长度可变） | 填充 
 
 部分解释：
 
- 标识 : 是个计数器，每产生一个数据报就加1 当一个数据报超过MTU时
         必须分片，每个数据报片会复制一遍标识号
         
- 标志 ： 最低位MF MF=1 则还有后面还有分片，MF=0 表示最后一个分片
          标志字段中间一位是 DF ，只有当DF=0才允许分片
          
         
- 片位移：指出分片后的某片的相对位置，8字节为一个单位，除了最后一个外，分片长度必是8B的整数倍

- 生存时间 ： 数据报在网络中通过的路由数的最大值，标识分组在网络中寿命，确保分组不会永远循环
             转发分组之前TTL 减一 当TTL为0时 ，必须丢弃
             
- 协议 ： 分组携带数据使用哪种协议

- 首部校验和 ： 只校验首部  不校验数据
  
```

```
IP 数据报分片：   
一个链路层承受的最大数据称为最大传送单元（MTU）   
- DF 为 0 ，代表该是分片
- MF 为 0 ，代表最后一个分片
- 有效数据

```

```
IPv4地址(早期分类AP地址) ： <网络号> + <主机号>

- A 类 1~126    -> 0 网络号（7）  主机号（24） 
-   类 127 -> .... 环回自检地址  
- B 类 128~191  -> 1 0  网络号（15）  主机号（16）
- C 类 192~223  -> 1 1 0 网络号（21）  主机号（8）

- D 类 224~239  -> 1 1 1 0  多播地址
- E 类 240~259  -> 1 1 1 1  <保留 以后用>

可用网络数 = 2^主机数 - 2

- 网络号在整个因特网都是唯一的 
- 主机号在前面网络号指定的网络范围是 唯一的 
```
```
特殊的IP地址表示的作用：

- 主机号为0 表示本网络本身： xxx.xx.xxx.0 (网络本身)
- 主机号全1 表示本网络广播地址（直接广播地址） xxx.xx.xxx.255 (直接广播地址)
- 32位全为 0 表示本网络的主机 : 0.0.0.0
- 32位全为 1 表示整个TCP/IP网络的广播地址(受限广播地址) 255.255.255.255

```

```
IP地址特点： 
- ip地址管理机构只发配 网络号 ， 主机号由得到该网络单位自行分配
- 路由器 仅根据目的主机连接的 网络号 来转发分组（缩小空间）
- 路由器 有好多个ip地址（多网络主机）
- 同一个广播域网络号相同 ，主机号必定不同
《由于无分类IP地址(CIDR)进行路由选择，这种传统的ip地址已成为历史》
```

```
网络地址转换 NAT :
 - NAT 专用网络 -> 公用网络
 - 隐藏内部管理的 ip 地址（安全）
 
连接NAT的私有ip地址允许重复使用：
其私有地址网段如下：

A类 : 1 个 A类网段 即 10.0.0.0 ~ 10.255.255.255
B类 ： 16 个 B类网段 即 172.16.0.0 ~ 172.31.255.255
C类 ： 256 个 C类网段 即 192.168.0.0 ~ 192.168.255.255

- 目的地址是私有地址数据报一律不允许转发
- 私有IP地址互联网网络(专用互联网&本地互联网)
- 私有IP地址 称 可重用性地址

NAT路由器转发数据报需要查看和转换输出层的端口号，且更换其IP地址
```
```
子网划分：
- 两级ip地址缺点： ip地址空间的利用率有时很低，路由表太大导致网络性能变慢

基本思想 ：
 - 子网划分存储是 单位内部事情，对外表现没有划分子网的网络
 - 从主机号借了若干比特作为 子网号  <网路号> <子网号> <主机号>
 - RFC950 规定 全1 全0 子网号不能使用 ，CIDR 规定 ，全1 全0 子网号也能使用
 - 补充上一点 ： 全 1 为广播地址 全0 为 子网的网络号
 
```

``` 
子网掩码：(告诉主机号网络类型 AND 与运算 &)
A 类  掩码 ： 255.0.0.0  AND xxx.0.0.0
B 类  掩码 ： 255.255.0.0  AND xxx.xxx.0.0
C 类  掩码 ： 255.255.255.0  AND xxx.xxx.xxx.0
```
```
无分类编制 CIDR :
- 是在变长子网掩码的基础提出的一种消除传统的 A B C 的网络划分
- 并在软件的支持下实现网构造的一种ip地址划方法

CIDR 使用网络前缀概念代替子网路的概念

网络前缀的位数不是固定的：（可任意选取）

    IP :: = {<网络前缀> ， <主机号>}
    
```

```
CIDR 斜线记法：
        ip 地址  / 网络前缀所占比特数 
 如 128.14.32.5 / 20 （网络前缀占20个比特数 ）
 
 CIDR 子网掩码 :网络前缀的 1 + 剩下全是0 （32位）
 CIDR 网络前缀 ： IP地址 与运算 子网掩码 （取/后面数字位数）
 
 将网络前缀都相同的连续IP地址组成的 CIDR地址块
 一个CIDR 表示很多地址，这些地址称为路由聚合  构成 超网
 - 超网 减少了路由器信息交换，从而提高了网络性能
 
```
```
CIDR 性能：

- CIDR 地址块中的地址数一定是 2的整数次幂，实际可指派的地址数通常是 2^N -2 
- 网络前缀短，可用地址多 三级结构ip地址中，划分子网使网络前缀变长
- CIDR 优点在于 ，网络前缀的灵活性
- 最长前缀匹配（最佳匹配），查找路由表中，选最长的前缀，地址少 更具体
```
```
网络分组的转发过程：
转发表信息 ：
  < 目的网络 ， 下一跳地址>
- 在CIDR查到多个匹配前缀，选最长的，地址少，跳的具体

特殊路由器：
- 主机路由： a.b.c.d/32 /32网络 表示子网掩码没有意义
- 默认路由： 0.0.0.0/0 
- 注意 ：下一跳IP地址 转换成MAC 地址（通过APR） ，再找到下一跳路由器
（MAC帧的源地址 和目标地址发生变化，网桥转发帧时，不改变帧的源地址）
```

| 名称 | 解释 |进一步解释 |补充
|--|--|--|--|
IP地址与硬件地址|IP分组多次路由转发到目标网络，在目标LAN通过数据链路层MAC广播寻址|ip分层次 MAC平面|路由器多个ip地址硬件地址
地址解析协议ARP|ARP工作在网络层，在高速缓存中查是否目标主机的IP地址，有就查出目标地址|没有的话广播发送|不在一共局域网转发下一个网络
动态主机配置协议DHCP|即插即用，DHCP是应用层协议基于UDP,使用客户/服务器，加入新网络自动获取地址（零食地址） 同时广播报文，DHCP服务器回答报文（提供报文）|允许网络上配置多个DHCP服务器|客户机挑最快的一个
网络报文控制协议ICMP| 提高数报交付的成功率，提供ICMP差错报告报文 和ICMP询问报文
```
- 无论网络层使用什么协议，在实际网络的链路上传送数据帧，最终必须使用硬件地址
```
```
ICMP 差错报文种类 5类
- 终点不可达
- 源点抑制：用于拥塞丢弃数据报
- 时间超过
- 参数问题
- 改变路由
ICMP 询问报文种类 4类
- 回送请求和回答报文
- 地址掩码请求和回答报文
- 时间戳请求和回答报文
- 路由器询问和回答报文
ICMP最常用的是分组网间探测 PING用来测试两台主机连通性
- ping工作在应用层 直接使用网络层 ICMP ,未使用传输层TCP 和 UDP
```


## 打卡专区：


## 答案汇总: 
1-5  CBCBD
6-10 DADBB
11-15 AAADB
16-20 CACAC
21-25 A (D、A) B D B
26-30 CDBAB
31-35 ACCC CA
36-40 BCADC
41-45 BCCDA
46-50 BCCDC
51-55 ACDBB
56 B
