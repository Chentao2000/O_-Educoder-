## 学习笔记:
```
TCP的特点：
- TCP面向连接传输层协议，TCP是一个逻辑连接
- 每条TCP只能连接两个端口，每条TCP只能是端到端(进程对进程)
- TCP提供全双工通信，允许通信双方应用进程在任何时候通信
- TCP提供可靠交付服务 ，保证传送的数据无差错 不丢失 不重复且有序
- TCP是面向字节流: 应用程序和TCP交互是一次一个数据块

UDP报文长度由发送应用进程决定的
TCP报文长度则根据接收方给出的窗口值和当前网络的拥塞成都来决定的

TCP缓存数据太长，TCP就把他划分短点再传送，
如果TCP太短，TCP也可以等待积累足够多的字节再传送

```
```
TCP的报文段:
TCP传送的数据单元称为报文段
- TCP 报文段 运载数据 进阿里连接
- 整个TCP报文段作为IP数据报的数据部分封装再IP数据报里
- 首部的前20B是固定的 ，TCP首部最短是 20B ，后面又4N字节根据需要增加选项，长度为3B整数倍
TCP各字段的意义:
- 源端口和目的端口 ：2B
- 序号 ： 4B
- 确认号 ： 4B
- 数据偏移（首部长度） 占 4位 ，最大长度是60B 
- 保留 : 占 6位
- 紧急位 URG:当URG =1 表明该紧急指针有效，告诉系统报文段尽快传送
- 确认位:ACK 当ACK=1 时确认有效 ，建立连接所有报文端ACK标记为1
- 推送位PUSH: 接收方TCP收到PSH=1的报文段，就立马推送，不必等缓存满了
- 复位为 RST : 当RST=1 tcp出现严重差错，必须释放连接在重新连接
- 同步位 SYN : SYN=1表明这个是一个连接请求报文，当SYN = 1 ACK =0 则代表发送请求 SYN =1 ACK =1 代表对方同意建立连接：
- 终止位 FIN : 用来释放一个连接，当FIN = 1 表明此报文段发送方数据已发送完毕，要求释放运输连接
- 窗口 ： 占2B ，指出现在允许对方发送的数据量
- 校验和： 占2B ,校验和字段校验包括 首部 和 数据两部分
- 紧急指针： 占2B  紧急指针在URG为1才有意义，它指出本报文段中紧急数据
- 选项 ： 长度可变， MSS 即最大报文长度
- 填充： 整个首部长度是 4B的整数倍

```

```
TCP面向连接管理：连接建立 数据传送 连接释放

三个问题：
-  每一方都感知对方存在
-  允许双发协商一些参数（如窗口最大值...）
-  能够对运输实体资源（如缓存大小 连接项目等）进行分配

TCP连接的端口是套接字，每条TCP唯一地被通信的两个端口确定
- TCP连接建立 客户/服务器 模型
- 主动发起连接建立进程 ： 客户
- 被动等待连接建立的应用进程称为 服务器

```

```
TCP的的连接建立（3次握手（招手）建立全双工连接）：

连接之前 ，服务器进程处于LITEN（收听）状态，等待客户的连接请求：

- 第一步：客户机先向服务器发送请求报文段，特殊报文段首部同步SYN （同步位）置 1，选择初始序号 seq = x 
- TCP 规定 ,SYN 报文段不能携带一个数据 消耗一个序号，TCP客户进程 进入SYN-SENT （同步已发送）状态

- 第二步：服务器的TCP连接请求报文段，如同意连接，则向客户机发回确认，并为该TCP连接分配 缓存 和向量，
- 将SYN位和ACK置1 ,确认号是ack = x+1 这个序号，此时 TCP服务器进程进入SYN-RCYD(同步收到)

- 第三步： 当客户机收到确认报文段，还要给服务器给出确认，并为该tcp连接分配缓存和变量，确认报文端ACK位置1 
- 确认号 ack = y + 1 ，序号 seq = x +1 ，该报文不能携带数据，但要消耗掉一个序号，TCP客户进入ESTABLISHED

- 服务器资源是完成第二次握手时分配的，客户端的资源是在完成第三次握手确认的，这就使得服务器易于受到SYN洪泛攻击

```
TCP的的连接建立（4次握手（挥手）断开全双工连接）：
- 全双工 ：两条连接
参与TCP连接的两个进程中的任何一个都能终止该连接，TCP连接释放的过程称为四次挥手：

第一步 ： 客户机打算关闭连接，向其TCP发送释放的报文段，并停止发送数据，主动关闭TCP连接
该报文段终止位FIN置1，序号seq=u，FIN报文不携带数据 消耗一个序号
TCP客户进程进入FIN=WAIT-1 终止等待状态 1 

第二步: 服务器收到连接释放报文段后发送确认 ，确认号ack = u +1 ,序号 seq = ,
等于前面已传送的数据最后一个字节序号 +1  ,TCP处于半关闭状态，但服务器发送数据，客户机仍要接受

第三步： 服务器已经没有要向客户机发送的数据，就通知TCP释放连接 FIN =1 连接释放报文端，该报文段的序号为w
重复已发送的确认号 ack = w +1 ，此时服务器进入LAST -LCK最后确认状态

第四步：客户机收到连接释放的报文段后，必须发出确认，确认位ACK置于1，确认号ack =w +1
序号 seq = w+1 ,此时TCP连接还未释放，必须经过时间等待计时器设置为2MSL（最长报文端释放）
客户机才进入CLOSED （连续关闭的状态）
```

```
TCP可靠传输
- TCP的任务是在IP层不可靠的，尽力而为服务的基础上建立一种可靠数据传输服务
- TCP 使用了校验 序号 确认 和重传机制来达到这一目的，其中TCP校验机制与UDP校验一样

1. 序号：建立在字节流上，每个字节一个序号
2. 确认: TCP首部确认号，TCP累积确认，只确认数据流中第一个丢失的字节
3. 重传： （1）超时 （2）冗余ACK ： 

```
```
TCP的流量控制：
TCP基于滑动窗口协议的流量控制协议
- 接收方根据自己接收的缓存大小，动态地调整发送窗口大小
```

```
TCP拥塞控制：
- 拥塞控制是指防止过多的数据注入网络，保证网络中的路由器或链路不至于过载
- 拥塞过载是一个全局的过程，流量控制是点对点的通信量的控制

因特网建立标准：拥塞控制4种算法：慢开始、拥塞避免、快重传和快恢复
- 接收窗口rwnd：接收方根据目前接受缓存大小所承诺的最新窗口值，反映接收方的容量
- 拥塞窗口cwnd: 发送方根据自己估算的网络拥塞程度而设置的窗口值，反应当前网络容量
```
发送窗口的上限值 = min[rwmd,cwnd]
接收窗口大小根据TCP报文首部窗口字段通知发送方，发送方如何维护拥塞窗口cwnd增长速率慢
```

```
慢开始和拥塞避免：
（1）慢开始算法：
- TCP刚开始发送TCP报文段，先令拥塞窗口cwnd = 1，即一个最大报文字段长度MSS,每收到一个新报文段，cwnd+1 即增加一个MSS（指数增加）
- 慢开始并不是指拥塞窗口增长速率cwnd 缓存增加，是指发送时候从一个比较低的开始
（2）拥塞避免：
- 拥塞窗口cwnd 缓慢增加，每经过一个往返时延RTT就把发送的拥塞窗口cwnd  缓慢增加 ，而不是增加好几倍（加法放大）
根据cwnd 大小执行不同的算法
cwnd < ssthresh : 慢开始算法
cwnd > ssthresh : 停止使用慢开始算法而改用拥塞避免算法
cwnd = ssthresh ： 慢开始算法，又可以使用拥塞避免算法
（3）网络拥塞的处理：
```
```
快重传 和 快恢复：

-用冗余ACK检测丢包的发生，通用冗余ACK也可以用于网络拥塞的检测（丢包检测）
（1）快重传： 快重传技术发送方连接收到3个冗余ACK 直接重传对方尚未发送的报文段
（2）快恢复: 发送方连接收到3个冗余ACK 重复确认，执行乘法减小，把慢开始的门槛 sshresh设置成cwnd的一半，然后慢慢开始拥塞避免算法(加法
放大)
```


## 错题记录:

2 A -> C
7 A -> C
8 C -> A
15 AB -> AC
16 B -> D
17 B -> C
20 C -> B
23 A
37 C->D
38 B -> C
41 C


## 打卡专区：
![图片](https://user-images.githubusercontent.com/68007558/181210697-8de0d7d3-f603-4623-9514-5ec806763775.png)


## 答案汇总: 

1-5 CCDBD
6-10 BCACA
11-15 CDAC (A\C)
16-20 DCBCC
21-25 CDABA
26-30 DCACB
31-35 BAAAC
36-40 DDCBC
41 C

## 刷题补充:

- IP首部有一共协议字段 ，用于指明上层协议是 TCP 还是UDP ，17代表UDP ，6代表TCP
- UDP首部有8B TCP首部最短有20B （放在报文段的数据部分）
